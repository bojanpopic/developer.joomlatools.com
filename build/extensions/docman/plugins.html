<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>Plugins | Joomlatools Developer Zone</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.5.0">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
        
    
    
    <link rel="next" href="../../extensions/logman.html" />
    
    
    <link rel="prev" href="../../extensions/docman/custom-icon-sizes.html" />
    
<link rel="stylesheet" href="http://use.typekit.net/c/96df50/1w;proxima-nova,2,b5x:N:i4,b61:N:i7,b5r:N:n1,b5t:N:n3,b5w:N:n4,bBh:N:n7;proxima-nova-alt,2,S9j:N:i4,S9d:N:i7,S9h:N:n4,S9c:N:n7/d?3bb2a6e53c9684ffdc9a98f41a5b2a62f97c6e2d19ae8171762f36a47b7ae4c15c15262578921b579b40772b17a4eeecbd196d5e41afbde63d066aca0adb6668b3041dcb1bd480ac9835af7a0262b3e6e63c8d629858af7ef7fe3d8800ea88755285b723ce632daa8d9425ed73e43cc241d0f1e654decd26a99bef6b3084bb5074fe9cbb89cd4392dd2e1eb9de20e42e0e2e9f26565e45aa62105f55a5be79697d144a19d6b9a27417ef903139e47ca0fef68be9fc7c58ca6a25b10107d6a34c73963e79a0b2702ffdc2637834bf784bd1fe0d69007cbd45f4021e4d">

        
    </head>
    <body class="no-js">
    <script data-inline type="text/javascript">function hasClass(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}var el=document.body;var cl="no-js";if(hasClass(el,cl)){var reg=new RegExp("(\\s|^)"+cl+"(\\s|$)");el.className=el.className.replace(reg," js-enabled")}</script>
        
        
<link rel="stylesheet" href="../../gitbook/style.css">
<link rel="stylesheet" href="../../gitbook/theme.css">


        
    <div class="jt_header">
        <div class="jt_navigation_container">
            <div class="jt_navigation__inner">
                <a class="jt_brand" href="http://www.joomlatools.com/">
                    <span class="joomlatools_logo">Joomlatools</span>
                </a>
                <ul class="rm-closed">
                    <li class="jt_menu__item" role="menuitem">
                        <a href="http://www.joomlatools.com/extensions">Extensions</a>
                    </li>
                    <li class="jt_menu__item" role="menuitem">
                        <a href="http://www.joomlatools.com/pricing">Pricing</a>
                    </li>
                    <li class="jt_menu__item" role="menuitem">
                        <a href="http://blog.joomlatools.com">Blog</a>
                    </li>
                    <li class="jt_menu__item" role="menuitem">
                        <a href="http://demo.joomlatools.com">Demo</a>
                    </li>
                    <li class="jt_menu__item" role="menuitem">
                        <a href="http://support.joomaltools.com">Support</a>
                    </li>
                    <li class="jt_menu__item user user--logged-in" id="user-logged-in" role="menuitem">
                        <a href="http://support.joomlatools.com/dashboard">
                            <span class="gravatar"><img src="" /></span>
                            Account
                        </a>
                    </li>
                    <li class="jt_menu__item user user--logged-out" id="btn-login" role="menuitem">
                        <a href="http://support.joomlatools.com/login">Log in</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        if (document.querySelectorAll) {
            function isUserLoggedIn (data) {
                if (data.item.name) {
                    document.querySelectorAll('li.user--logged-in img')[0].src = data.item.gravatar;
                    localStorage.setItem('gravatar', data.item.gravatar);
                }
                else {
                    var reg = new RegExp('(\\s|^)user-logged-in(\\s|$)');
                    document.body.className = document.body.className.replace(reg,' ');

                    localStorage.removeItem('gravatar');
                }
            }

            function readCookie(name) {
                var nameEQ = name + '=';
                var ca = document.cookie.split(';');
                for(var i=0;i < ca.length;i++) {
                    var c = ca[i];
                    while (c.charAt(0) === ' ') {
                        c = c.substring(1,c.length);
                    }
                    if (c.indexOf(nameEQ) === 0) {
                        return decodeURIComponent(c.substring(nameEQ.length,c.length));
                    }
                }
                return null;
            }

            /* See if we have both the session and avatar set */
            var session  = readCookie('jt-session');
            var gravatar = localStorage.getItem('gravatar');

            /* If both are set, show the Member Center button */
            if (session) {
                document.body.className += ' user-logged-in';

                if (gravatar && gravatar.substring(0, 15) == 'data:image/png;') {
                    document.querySelectorAll('li.user--logged-in img')[0].src = gravatar;
                }

                /* Always validate the user session in the background. If it expired or user
                 has logged out, we need to update accordingly. */
                var scr = document.createElement('script');
                scr.src = 'http://support./data/user?hash='+encodeURIComponent(session);
                document.body.appendChild(scr);
            }
            else {
                localStorage.removeItem('gravatar');
            }
        }
    </script>

    <div class="book" data-level="1.1.2" data-basepath="../.." data-revision="1428573520809">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="extensions/docman/custom-icons.html">
            
                
                    <a href="../../extensions/docman/custom-icons.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Extensions
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="extensions/docman/custom-icons.html">
            
                
                    <a href="../../extensions/docman/custom-icons.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         DOCman
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1.1" data-path="extensions/docman/custom-icons.html">
            
                
                    <a href="../../extensions/docman/custom-icons.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.1.</b>
                        
                         Custom Icons
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1.1.1" data-path="extensions/docman/custom-icon-sizes.html">
            
                
                    <a href="../../extensions/docman/custom-icon-sizes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.1.1.</b>
                        
                         Sizes
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter active" data-level="1.1.2" data-path="extensions/docman/plugins.html">
            
                
                    <a href="../../extensions/docman/plugins.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.2.</b>
                        
                         Plugins
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="extensions/logman.html">
            
                
                    <a href="../../extensions/logman.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         LOGman
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.2.1" data-path="extensions/logman/plugins/README.html">
            
                
                    <a href="../../extensions/logman/plugins/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.1.</b>
                        
                         Plugins
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.2.1.1" data-path="extensions/logman/plugins/joomla.html">
            
                
                    <a href="../../extensions/logman/plugins/joomla.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.1.1.</b>
                        
                         Joomla components
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2.1.2" data-path="extensions/logman/plugins/nooku.html">
            
                
                    <a href="../../extensions/logman/plugins/nooku.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.1.2.</b>
                        
                         Nooku components
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2.1.3" data-path="extensions/logman/plugins/activities.html">
            
                
                    <a href="../../extensions/logman/plugins/activities.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.1.3.</b>
                        
                         Activities
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="1.2.2" data-path="extensions/logman/translations.html">
            
                
                    <a href="../../extensions/logman/translations.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.2.</b>
                        
                         Translations
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="framework/bootstrap.html">
            
                
                    <a href="../../framework/bootstrap.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Framework
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="framework/template-system.html">
            
                
                    <a href="../../framework/template-system.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         Template System
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1.1" data-path="framework/custom-css.html">
            
                
                    <a href="../../framework/custom-css.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.1.</b>
                        
                         Custom CSS
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.1.2" data-path="framework/bootstrap.html">
            
                
                    <a href="../../framework/bootstrap.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.2.</b>
                        
                         Bootstrap
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.1.3" data-path="framework/overrides.html">
            
                
                    <a href="../../framework/overrides.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.3.</b>
                        
                         Overrides
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.1.4" data-path="framework/layouts.html">
            
                
                    <a href="../../framework/layouts.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.4.</b>
                        
                         Layouts
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2.2" data-path="framework/plugins.html">
            
                
                    <a href="../../framework/plugins.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         Plugins
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="tools/composer/introduction.html">
            
                
                    <a href="../../tools/composer/introduction.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Tools
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" data-path="tools/composer/introduction.html">
            
                
                    <a href="../../tools/composer/introduction.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                         Composer
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1.1" data-path="tools/composer/installing.html">
            
                
                    <a href="../../tools/composer/installing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.1.</b>
                        
                         Installing Packages
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.1.2" data-path="tools/composer/creating.html">
            
                
                    <a href="../../tools/composer/creating.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.2.</b>
                        
                         Distributing Packages
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.1.3" data-path="tools/composer/faq.html">
            
                
                    <a href="../../tools/composer/faq.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.</b>
                        
                         FAQ
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3.2" data-path="tools/vagrant/introduction.html">
            
                
                    <a href="../../tools/vagrant/introduction.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                         Vagrant
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.2.1" data-path="tools/vagrant/howto.html">
            
                
                    <a href="../../tools/vagrant/howto.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.1.</b>
                        
                         How to use
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.2.2" data-path="tools/vagrant/faq.html">
            
                
                    <a href="../../tools/vagrant/faq.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.2.</b>
                        
                         FAQ
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3.3" data-path="tools/console/introduction.html">
            
                
                    <a href="../../tools/console/introduction.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                         Console
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.3.1" data-path="tools/console/installation.html">
            
                
                    <a href="../../tools/console/installation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.1.</b>
                        
                         Installation
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3.2" data-path="tools/console/usage.html">
            
                
                    <a href="../../tools/console/usage.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.2.</b>
                        
                         Usage
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3.3" data-path="tools/console/faq.html">
            
                
                    <a href="../../tools/console/faq.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.3.</b>
                        
                         FAQs
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" >Joomlatools Developer Zone</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_4">
                    
                        <h1 id="plugins">Plugins</h1>
<p><strong>Read the <a href="/framework/plugins.html">Framework Plugins</a> guide to get the absolute most out of this tutorial</strong>. We build on concepts that are covered in that guide.  </p>
<p>There are times when you may want to alter or augment the functionality of DOCman to suit a specific need in a given situation.
Perhaps you want to send an email when a document is uploaded. Maybe you want add some data to the list of documents before
it gets rendered to the screen. Whatever you would like to do is possible with Plugins and our Event driven architecture. </p>
<!-- toc -->
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#setup">Setup</a><ul>
<li><a href="#xml-descriptor">XML Descriptor</a></li>
</ul>
</li>
<li><a href="#php-class">PHP Class</a><ul>
<li><a href="#basic-example-method">Basic Example Method</a></li>
</ul>
</li>
<li><a href="#real-life-example-plugin">Real Life Example Plugin</a></li>
<li><a href="#in-closing">In closing</a></li>
</ul>
<!-- toc stop -->
<h2 id="introduction">Introduction</h2>
<p>DOCman is a Nooku Framework powered extension and as such, has access to a powerful, yet simple event architecture. Almost ANY action in DOCman can have an event listener registered against it. Not only that, but multiple listeners can be registered for a single event.</p>
<p>In the majority of cases, you will want to register an event listener against a controller action. This is not a requirement though, you can also register listeners against all model, view and controller actions. </p>
<p>There are a number of entities in DOCman for whose MVC actions you may wish to register an event handler against:</p>
<table>
<thead>
<tr>
<th>In the Site component</th>
<th>In the Administrator component</th>
</tr>
</thead>
<tbody>
<tr>
<td>Document</td>
<td>Document</td>
</tr>
<tr>
<td>Download</td>
<td>Category</td>
</tr>
<tr>
<td>List</td>
<td>File</td>
</tr>
</tbody>
</table>
<p>To get a sense of the granularity of the events that a plugin can subscribe to have a look at <a href="/framework/plugins.html#what-is-possible">&quot;What is Possible?&quot;</a> in the Framework Plugins guide. </p>
<h2 id="setup">Setup</h2>
<p>A plugin consists of at least 2 files, a PHP class and an XML descriptor. </p>
<blockquote>
<p>We cover the major details of each in <a href="/framework/plugins.html#creation-and-installation">Creation and Installation</a> section of the Framework Plugin guide.</p>
</blockquote>
<h3 id="xml-descriptor">XML Descriptor</h3>
<p>This is what our <em>bare bones</em> plugin manifest file should look like. </p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">extension</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"2.5"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"plugin"</span> <span class="hljs-attribute">group</span>=<span class="hljs-value">"docman"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>DOCman Document Plugin<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">author</span>&gt;</span>YOUR NAME<span class="hljs-tag">&lt;/<span class="hljs-title">author</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">creationDate</span>&gt;</span>June 2013<span class="hljs-tag">&lt;/<span class="hljs-title">creationDate</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">description</span>&gt;</span>PLUGIN DESCRIPTION<span class="hljs-tag">&lt;/<span class="hljs-title">description</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">files</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">filename</span> <span class="hljs-attribute">plugin</span>=<span class="hljs-value">"document"</span>&gt;</span>document.php<span class="hljs-tag">&lt;/<span class="hljs-title">filename</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">files</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">extension</span>&gt;</span>
</code></pre>
<p>We&#39;ve made our <code>group</code> attribute &quot;docman&quot; because we are altering the data from DOCman. The system will make sure that this group of plugins is loaded whenever a DOCman event is broadcast. Also for the sake of illustration, we have named our plugin <code>document</code> in </p>
<p><code>&lt;filename plugin=&quot;document&quot;&gt;document.php&lt;/filename&gt;</code> </p>
<p>However, you are free to name your plugin anything you like.</p>
<h2 id="php-class">PHP Class</h2>
<p>The class that matches our new manifest starts out looking something like</p>
<pre><code class="lang-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PlgDocmanDocument</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PlgKoowaSubscriber</span></span>{}
</code></pre>
<h3 id="basic-example-method">Basic Example Method</h3>
<pre><code class="lang-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PlgDocmanDocument</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PlgKoowaSubscriber</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onBeforeDocumentControllerAdd</span><span class="hljs-params">(KEventInterface <span class="hljs-variable">$event</span>)</span>
    </span>{
        <span class="hljs-comment">//Do something like sending an email to an administrator and disabling the document</span>
        <span class="hljs-variable">$event</span>-&gt;data-&gt;enabled = <span class="hljs-number">0</span>;
        mail(<span class="hljs-string">'admin@yoursite.com'</span>,
            <span class="hljs-string">'New document added'</span>,
            <span class="hljs-string">'A new document has been added with title:'</span>.<span class="hljs-variable">$event</span>-&gt;data-&gt;title
        );
    }
}
</code></pre>
<p>Here is an event handler that we might use to help moderate document submissions. 
We are doing two things here: </p>
<ol>
<li>want to make sure that the document is not published right away </li>
<li>and that we get notified of the submission. </li>
</ol>
<p>Our <code>onBeforeDocumentControllerAdd</code> method follows a <a href="/framework/plugins.html#naming">specific naming convention</a>.</p>
<blockquote>
<p>Event names are built by Nooku&#39;s Event command handler, <a href="https://github.com/nooku/nooku-framework/blob/master/code/libraries/koowa/libraries/command/handler/event.php#L120" target="_blank">KCommandHandlerEvent</a>. </p>
</blockquote>
<p>That method reads as follows</p>
<blockquote>
<p><strong>Before</strong> a <strong>Document</strong>  entity <strong>Controller</strong> executes the <strong>Add</strong> method , do this</p>
</blockquote>
<p>For controller focused events the <code>$event</code> variable gets the <code>data</code> property. This is made up of the input data of the request coming into the action. We intercept it with a <strong>Before</strong> event handler because we want to disable the document before we add it to the database.</p>
<p>Refer to <a href="/framework/plugins.html#mvc-actions-and-events">MVC Actions and Events</a> for detailed information about specific <code>$event</code> variable properties and the actions they are geared towards. </p>
<h2 id="real-life-example-plugin">Real Life Example Plugin</h2>
<p>Let&#39;s work through a real world example that was actually requested in the Joomlatools forum. It will help solidify the concepts we have covered so far. </p>
<blockquote>
<p>&quot;We want to use DOCman for special document processing. The document description will contain keywords for special tagging (year of publishing, author etc).
If the document is saved, modified or deleted we would listen to these events and store this information in a custom database table so that we can do special search operations.&quot;</p>
</blockquote>
<p>So let&#39;s go ahead and work out what events we need to respond to:</p>
<ul>
<li>When: <strong>after</strong> - we do this after the action has run so that if the action were to fail, our event listener won&#39;t run.</li>
<li>Component: <strong>docman</strong> - This is to only affect the DOCman extension.</li>
<li>Name: <strong>document</strong> - We&#39;re only interested in documents</li>
<li>Action: <strong>add</strong>,<strong>edit</strong>,<strong>delete</strong> - Save/modify/delete events</li>
</ul>
<p>Therefore the event method names we need are:</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PlgDocmanDocument</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PlgKoowaSubscriber</span>
</span>{
        onAfterDocmanDocumentControllerAdd(KEventInterface <span class="hljs-variable">$event</span>){}
        onAfterDocmanDocumentControllerEdit(KEventInterface <span class="hljs-variable">$event</span>){}
        onAfterDocmanDocumentControllerDelete(KEventInterface <span class="hljs-variable">$event</span>){}
}
</code></pre>
<p>Pretty simple so far right?</p>
<p>Now consider save events, these cover both add and edit (create and update), so the simplest way to have both of these methods run the same code is have one call the other.</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PlgKoowaDocman</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PlgKoowaSubscriber</span>
</span>{
        onAfterDocmanDocumentControllerAdd(KEventInterface <span class="hljs-variable">$event</span>)
        {
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;onAfterDocmanDocumentControllerEdit(<span class="hljs-variable">$event</span>);
        }
        onAfterDocmanDocumentControllerEdit(KEventInterface <span class="hljs-variable">$event</span>){}
        onAfterDocmanDocumentControllerDelete(KEventInterface <span class="hljs-variable">$event</span>){}
}
</code></pre>
<p>Now, let&#39;s flesh out the edit event.</p>
<p>In the brief the customer gave, they want to react to certain keywords for special tagging. As we don&#39;t know the format for this, let&#39;s just say they&#39;ll be in the format <code>{year:X}</code> and <code>{author:Y}</code>  where <strong>X</strong> is the year number and <strong>Y</strong> is the author name.</p>
<p>First things first; we need to get the document that was added/edited. This is contained within the <code>result</code> property of the <code>$event</code> object as it&#39;s the &quot;result&quot; of the action that&#39;s being performed.</p>
<p>Secondly we need to get the <code>description</code> field of the document entity that we&#39;re going to check for the keywords.</p>
<pre><code class="lang-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAfterDocmanDocumentControllerEdit</span><span class="hljs-params">(KEventInterface <span class="hljs-variable">$event</span>)</span>
</span>{
    <span class="hljs-comment">//The result of the controller action is stored in the "result" property</span>
    <span class="hljs-variable">$row</span> = <span class="hljs-variable">$event</span>-&gt;result;
    <span class="hljs-comment">//The row contains properties that map to the database table columns</span>
    <span class="hljs-variable">$description</span> = <span class="hljs-variable">$row</span>-&gt;description;
}
</code></pre>
<p>If you were to <code>var_dump($description)</code> or use your favorite debugger you should find that it contains the value of the <code>description</code> field.</p>
<blockquote>
<p>Note: you&#39;ll need to add an <code>exit()</code> or <code>die()</code> method after the var_dump otherwise the page will redirect and you won&#39;t see anything).</p>
</blockquote>
<p>Once we have the description, we can do some simple regular expression matches on it to extract the year and the author:</p>
<pre><code class="lang-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAfterDocmanDocumentControllerEdit</span><span class="hljs-params">(KEventInterface <span class="hljs-variable">$event</span>)</span>
</span>{
    <span class="hljs-comment">//The result of the controller action is stored in the "result" property</span>
    <span class="hljs-variable">$row</span> = <span class="hljs-variable">$event</span>-&gt;result;
    <span class="hljs-comment">//The row contains properties that map to the database table columns</span>
    <span class="hljs-variable">$description</span> = <span class="hljs-variable">$row</span>-&gt;description;
    <span class="hljs-comment">//You can now do anything you want with the data, for example look for certain keywords</span>
    <span class="hljs-variable">$year</span> = <span class="hljs-variable">$author</span> = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">'#{year:([\s0-9]*)}#'</span>, <span class="hljs-variable">$description</span>, <span class="hljs-variable">$match</span>)){
        <span class="hljs-variable">$year</span> = trim(<span class="hljs-variable">$match</span>[<span class="hljs-number">1</span>]);
    }
    <span class="hljs-comment">//Or get the author?</span>
    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">'#{author:([\s\w]*)}#'</span>, <span class="hljs-variable">$description</span>, <span class="hljs-variable">$match</span>)){
        <span class="hljs-variable">$author</span> = trim(<span class="hljs-variable">$match</span>[<span class="hljs-number">1</span>]);
    }
    <span class="hljs-comment">//Now do some custom query to store these values, perhaps store in a table using $row-&gt;id as an index?</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$year</span>){
        <span class="hljs-comment">//Do something</span>
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$author</span>){
        <span class="hljs-comment">//Do something</span>
    }
}
</code></pre>
<p>Simple as that :)</p>
<p>To get the sample plugin, visit here: <a href="https://github.com/joomlatools/docman-example/" target="_blank">Example Plugin</a>. You can download it
or even install it with Composer.</p>
<h2 id="in-closing">In closing</h2>
<p>We have shown you how to create event handlers for any DOCman controller action.</p>
<p>You can affect both the input and output of any one of those, or model and view actions by simply building and placing a plugin properly and following the method naming convention that we have outlined above. </p>
<p>Remember also, the handler method gets passed an <a href="https://github.com/nooku/nooku-framework/blob/master/code/libraries/koowa/libraries/event/interface.php#L10" target="_blank"><code>KEventInterface $event</code></a> object with most of the information you will need.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../extensions/docman/custom-icon-sizes.html" class="navigation navigation-prev " aria-label="Previous page: Sizes"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../extensions/logman.html" class="navigation navigation-next " aria-label="Next page: LOGman"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/theme.js"></script>
<script src="../../gitbook/app.js"></script>

    
    <script src="../../gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"ga":{"token":"UA-214238-3","configuration":"auto"}};
    gitbook.start(config);
});
</script>

        <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-214238-3', 'auto');ga('send', 'pageview');</script>
    </body>
    
</html>
