<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>Joomla | Joomlatools Developer Zone</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.0.3">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    <link rel="next" href="../../../extensions/logman/integrations/nooku.html" />
    
    
    <link rel="prev" href="../../../extensions/logman/integrations/README.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../../../gitbook/style.css">
<link rel="stylesheet" href="../../../gitbook/theme.css">


        
    <div class="navbar">
        <div class="navbar-inner">
            <a class="brand" href="http://www.joomlatools.com">
                <img src="/theme/assets/images/slogan.png?1408441510" alt="Joomlatools logo" border="0">
            </a>
            <ul class="menu nav">
                <li><a href="http://www.joomlatools.com/extensions"><span>Extensions</span></a></li>
                <li><a href="http://www.joomlatools.com/store"><span>Store</span></a></li>
                <li><a href="http://blog.joomlatools.com"><span>Blog</span></a></li>
                <li><a href="http://www.joomlatools.com/demo"><span>Demo</span></a></li>
                <li><a href="http://www.joomlatools.com/support"><span>Support</span></a></li>
            </ul>
        </div>
    </div>
    <div class="book"  data-level="4.1.1.1" data-basepath="../../.." data-revision="1412161152387">
        

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="tools/composer/introduction.html">
            
                
                    <a href="../../../tools/composer/introduction.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Composer
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="tools/composer/installing.html">
            
                
                    <a href="../../../tools/composer/installing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         Installing Packages
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="tools/composer/creating.html">
            
                
                    <a href="../../../tools/composer/creating.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         Distributing Packages
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.3" data-path="tools/composer/faq.html">
            
                
                    <a href="../../../tools/composer/faq.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                         FAQ
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="tools/vagrant/introduction.html">
            
                
                    <a href="../../../tools/vagrant/introduction.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Vagrant
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="tools/vagrant/howto.html">
            
                
                    <a href="../../../tools/vagrant/howto.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         How to use
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.2" data-path="tools/vagrant/faq.html">
            
                
                    <a href="../../../tools/vagrant/faq.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         FAQ
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="tools/console/introduction.html">
            
                
                    <a href="../../../tools/console/introduction.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Console
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" data-path="tools/console/installation.html">
            
                
                    <a href="../../../tools/console/installation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                         Installation
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.2" data-path="tools/console/usage.html">
            
                
                    <a href="../../../tools/console/usage.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                         Usage
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3" data-path="tools/console/faq.html">
            
                
                    <a href="../../../tools/console/faq.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                         FAQs
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4" data-path="extensions/README.html">
            
                
                    <a href="../../../extensions/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         Extensions
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="4.1" data-path="extensions/logman.html">
            
                
                    <a href="../../../extensions/logman.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                         LOGman
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="4.1.1" data-path="extensions/logman/integrations/README.html">
            
                
                    <a href="../../../extensions/logman/integrations/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.1.</b>
                        
                         Integrations
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter active" data-level="4.1.1.1" data-path="extensions/logman/integrations/joomla.html">
            
                
                    <a href="../../../extensions/logman/integrations/joomla.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.1.1.</b>
                        
                         Joomla
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.1.2" data-path="extensions/logman/integrations/nooku.html">
            
                
                    <a href="../../../extensions/logman/integrations/nooku.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.1.2.</b>
                        
                         Nooku
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4.1.2" data-path="extensions/logman/activities.html">
            
                
                    <a href="../../../extensions/logman/activities.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.2.</b>
                        
                         Activities
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.1.3" data-path="extensions/logman/translations.html">
            
                
                    <a href="../../../extensions/logman/translations.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.3.</b>
                        
                         Translations
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

        <div class="book-body">
            <div class="body-inner">
                <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../../" >Joomlatools Developer Zone</a>
    </h1>
</div>

                <div class="page-wrapper" tabindex="-1">
                    <div class="page-inner">
                
                    
                        <section class="normal" id="section-gitbook_860">
                        
                            <h1 id="joomla-components">Joomla! components</h1>
<p>By utilizing Joomla&#39;s event system, third party components built on top of the Joomla! Framework can be easily integrated with LOGman. </p>
<p><em>For information on integrating a component within the Joomla! event system, please refer to the <a href="http://docs.joomla.org/Plugin" target="_blank">Plugin</a> and <a href="http://docs.joomla.org/Plugin/Events" target="_blank">Events</a> Joomla! guides.</em></p>
<p>Once an application makes use of Joomla&#39;s event system, you can go ahead and create a plugin that listens for events and then notifies LOGman of the event.</p>
<h2 id="logman-plugins">LOGman plugins</h2>
<h3 id="events">Events</h3>
<p>The first step on integrating a component with LOGman is to create a LOGman plugin that listens to the events we would like to log.</p>
<p>The name of the plugin should match the name of the component. This is important so that LOGman may find overrides for activities of a given package/component.</p>
<p>There are two different types of events. Context events and Non-context events. LOGman plugins support all kind of events, but the way you write plugins differ depending on the type of events that it listens to.</p>
<h4 id="context-events">Context Events</h4>
<p>Context events are generic events that get triggered with a context argument. A context argument is a string that looks something like this:</p>
<pre><code>    com_newsfeeds.newsfeed
</code></pre><p>The first part (before the point) is the component triggering the event. The second part (after the point) is the event object, i.e. the resource over which the action or event takes place.</p>
<p>Context events are said to be generic since the same event may be triggered over more than one resource and/or by more than one component. As an example, the event that gets triggered after saving an article or a banner is <code>onContentAfterSave</code>. The same event gets fired after the save action for both resources. The context that get passed (<code>com_content.article</code> and <code>com_newsfeed.newsfeed</code> for articles and news feeds respectively) is what helps on making the difference between an article and a newsfeed save action.</p>
<h4 id="non-context-events">Non-context Events</h4>
<p>Contrarily to context events, non-context events are specific. This means that the event itself already provides information about who triggered the event and in what context. An example would be the <code>onUserAfterSaveGroup</code> event. By just looking at the event name, we know that it is users related and that it got triggered after saving a group.</p>
<p>With this in mind, let us re-develop the Newsfeeds LOGman plugin for logging newsfeeds activities. The newsfeeds core component triggers <strong>context</strong> events for notifying plugins. So let us first building a plugin that listens to those events for logging activities.</p>
<h3 id="plugins-listening-to-context-events">Plugins listening to Context Events</h3>
<p>The first step is to create a <code>newsfeeds.php</code> file in the <code>plugins/logman/newsfeeds</code> directory. The file should contain the following content inside:</p>
<pre><code>&lt;?php
    class PlgLogmanNewsfeeds extends ComLogmanPluginJoomla
    {
    }    
?&gt;
</code></pre><p>Congratulations! you have just created your first LOGman plugin!.</p>
<p>By default plugins extending the <strong>ComLogmanPluginJoomla</strong> class will listen to the following <strong>context</strong> events:</p>
<ul>
<li>onContentAfterSave</li>
<li>onContentAfterDelete</li>
<li>onExtensionAfterSave</li>
<li>onExtensionAfterDelete</li>
<li>onContentChangeState</li>
</ul>
<p>Unfortunately, at this stage, the plugin will not be logging anything. We need to provide it with more information about the things we want to log. Let&#39;s do exactly that.</p>
<p>Add the following code inside the class:</p>
<pre><code>    protected function _initialize(KObjectConfig $config)
    {
        $config-&gt;append(array(
            &#39;resources&#39; =&gt; array(&#39;newsfeed&#39;)
        ));

        parent::_initialize($config);
    }
</code></pre><p>We have just changed the way the plugin initializes itself. By specifying resources in the config object we are telling the plugin which resources are we interested on. In this case we have told the plugin to listen for newsfeed events.</p>
<p>Right now, and with a few lines of code, the onContentAfterSave and onContentAfterDelete events are going to log activities every single time a newsfeed is saved or deleted.</p>
<p>Easy right?. There is still one small catch. Let us talk about data. When an event is triggered, handlers are very often provided with a reference to the data on which the action or the event took place. In this case the handler is given a newsfeed object. For logging activities we need to tell the plugin how to use this data in order to pass this information to LOGman.</p>
<p>Out of the box, the plugin will guess two pieces of information that it needs to log activities: the resource <code>id</code> and its <code>name</code>. The plugin assumes that the resource <code>id</code> and <code>name</code> correspond to the <code>id</code> and <code>title</code> properties in the passed data object, i.e. <code>$newsfeed-&gt;id</code> and <code>`$newsfeed-&gt;title</code> respectively. If this is the case, then all will work out of the box. Otherwise a bit more work will be needed to tell the plugin how to get this information.</p>
<p>In the case of our example, the newsfeeds name can be grabbed using the <code>name</code> property. Because of this, we need to add the following piece of code in our plugin:</p>
<pre><code>    protected function _getNewsfeedObjectData($data, $event)
    {
        return array(&#39;id&#39; =&gt; $data-&gt;id, &#39;name&#39; =&gt; $data-&gt;name);
    }
</code></pre><p>The <code>_getNewsfeedObjectData</code> method gets called for getting the newsfeed data that will be passed to LOGman for logging the activity. The <code>$data</code> argument is the data passed to the event handler, i.e. the newsfeed object. The <code>$event</code> argument is a string containing the name of the event. The method should return an array containing at the very least the <code>id</code> and the <code>name</code> of the resource. Additionally, a <code>metadata</code> field can be provided with additional data that may be used for rendering activities. This field must contain an associative array of metadata.</p>
<p>As you may have guessed, the naming convention being used is <code>_get{Resource}ObjectData</code> where <code>{Resource}</code> is the object we are listenning events for. If we would be listening events for articles, the method for providing the activity data would be <code>_getArticleObjectData</code>.</p>
<p>Right now we have a working plugin that is capable of logging the following newsfeeds actions:</p>
<ul>
<li>Add</li>
<li>Edit</li>
<li>Delete</li>
</ul>
<p>Pretty awesome uh?. Le us improve the plugin by supporting state change events.</p>
<p>As mentioned above, the base <strong>ComLogmanPluginJoomla</strong> class also provides support for the <code>onContentChangeState</code> event. This event gets triggered when a resource state changes. The following core state changes are supported:</p>
<ul>
<li>Published</li>
<li>Unpublished</li>
<li>Archived</li>
<li>Trashed</li>
</ul>
<p>As with our previous example, under some circumstances all will work out of the box. However, sometimes the plugin needs a bit of help for figuring it out.</p>
<p>For logging state changes, the plugin needs to know the name of the Joomla! table class that defines the event object, a.k.a the resource. By default this is assumed to be <code>JTable{Resource}</code>. This is needed because unfortunately, the <code>onContentChangeState</code> event only provides the IDs of the resources which state is changing. Otherwise speaking, we need to load the resources ourselves in order to get the activity data to be logged.</p>
<p>In our example, the Table class being used for newsfeeds resources is <strong>NewsfeedsTableNewsfeed</strong>. For telling the plugin which table class to use we use the following code block:</p>
<pre><code>    protected function _getTable($config)
    {
        $config-&gt;append(array(
            &#39;prefix&#39; =&gt; &#39;NewsfeedsTable&#39;
        ));

        return parent::_getTable($config);
    }
</code></pre><p>The table class name is constructed with two variables that get passed to the <strong>_getTable</strong> method, <code>prefix</code> and <code>name</code>. In this case we are telling the getter method that <code>prefix</code> is <code>NewsfeedsTable</code>. By default, <code>name</code> corresponds to the resource name, i.e. <strong>Newsfeed</strong>, which is exactly what we need. Otherwise, <code>&#39;name&#39; =&gt; {name}</code> should be appended to the config object along with the prefix. By concatenating both (<code>prefix</code> + <code>name</code>), the getter is able to determine the class name, <strong>NewsfeedsTableNewsfeed</strong> for this example.</p>
<p>By simply adding the above piece of code, our plugin can now log state changes like a champ. Awesome!.</p>
<h3 id="plugins-listening-to-non-context-events">Plugins listening to non-Context Events</h3>
<p>The previous section walked you through the process of creating a basic LOGman plugin that listens to context events to log activities. While context events are nice and dandy, and can be used in the great majority of cases, many components out there also trigger non-context events. Do not panic, LOGman can handle those too!.</p>
<p>All we need to do for listening to any event is to add a handler for it, i.e. a plugin method, to our plugin:</p>
<pre><code>    public function on{EventName}($arg1, $arg2, ...)
    {
        $this-&gt;log(
            array(
                &#39;object&#39; =&gt; array(
                    &#39;package&#39;  =&gt; {package},
                    &#39;type&#39;     =&gt; {type},
                    &#39;id&#39;       =&gt; {id},
                    &#39;name&#39;     =&gt; {name},
                    &#39;metadata&#39; =&gt; {metadata}
                 ),
                &#39;verb&#39;   =&gt; {verb},
                &#39;actor&#39;  =&gt; {actor},
                &#39;result&#39; =&gt; {result}            
            )
        );
    }
</code></pre><p>where <code>{EventName}</code> is the name of the event we want to listen to. As an example, if we would like to listen to the <strong>onUserLogin</strong> event, our event handler must look like:</p>
<pre><code>    public function onUserLogin($user, $options = array())
    {
        ...
    }
</code></pre><p>For logging an activity the handler must issue a <strong>log</strong> call with some activity data. Part of this data is mandatory, the rest is of course optional. Let us start with the mandatory fields:</p>
<ul>
<li><code>{id}</code>: The unique identifier of the resource.</li>
<li><code>{name}</code>: The name/title of the resource.</li>
<li><code>{type}</code>: The type of the resource, e.g. user, article, newsfeed, etc.</li>
<li><code>{verb}</code>: The event action, e.g. delete, add, etc.</li>
<li><code>{result}</code>: The result of the event action, e.g. deleted, added, etc. This field is optional when verb is set to add, edit or delete. In this case the result is assumed to be added, edited or created respectively.</li>
</ul>
<p>Optional fields:</p>
<ul>
<li><code>{package}</code>: The package/component name that handles the resource, e.g. users, content, newsfeed, etc. Make sure not to include the the <strong>com_</strong> prefix.</li>
<li><code>{metadata</code>}: An associative array containing metadata.</li>
<li><code>{actor}</code>: The ID of the user executing the activity. If none is provided the ID of the current logged user will used.</li>
</ul>

                        
                        </section>
                    
                
                    </div>
                </div>
            </div>

            
            <a href="../../../extensions/logman/integrations/README.html" class="navigation navigation-prev " aria-label="Previous page: Integrations"><i class="fa fa-angle-left"></i></a>
            
            
            <a href="../../../extensions/logman/integrations/nooku.html" class="navigation navigation-next " aria-label="Next page: Nooku"><i class="fa fa-angle-right"></i></a>
            
        </div>
    </div>

        
<script src="../../../gitbook/js/apollo.js"></script>
<script src="../../../gitbook/js/vanilla.js.responsive.menu.js"></script>
<script src="../../../gitbook/app.js"></script>

    
    <script src="../../../gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../../../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

    
    <script src="../../../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
    responsivemenu.init({
        wrapper: document.getElementsByClassName('navbar')[0],
        before_element: document.getElementsByClassName('brand')[0],
        absolute: 1
    });
</script>
<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"ga":{"token":"UA-214238-3","configuration":"auto"}};
    gitbook.start(config);
});
</script>

        <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-214238-3', 'auto');ga('send', 'pageview');</script>
    </body>
    
</html>
