<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>Activities | Joomlatools Developer Zone</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.5.0">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="../../../extensions/logman/translations.html" />
    
    
    <link rel="prev" href="../../../extensions/logman/plugins/nooku.html" />
    
<link rel="stylesheet" href="http://use.typekit.net/c/96df50/1w;proxima-nova,2,b5x:N:i4,b61:N:i7,b5r:N:n1,b5t:N:n3,b5w:N:n4,bBh:N:n7;proxima-nova-alt,2,S9j:N:i4,S9d:N:i7,S9h:N:n4,S9c:N:n7/d?3bb2a6e53c9684ffdc9a98f41a5b2a62f97c6e2d19ae8171762f36a47b7ae4c15c15262578921b579b40772b17a4eeecbd196d5e41afbde63d066aca0adb6668b3041dcb1bd480ac9835af7a0262b3e6e63c8d629858af7ef7fe3d8800ea88755285b723ce632daa8d9425ed73e43cc241d0f1e654decd26a99bef6b3084bb5074fe9cbb89cd4392dd2e1eb9de20e42e0e2e9f26565e45aa62105f55a5be79697d144a19d6b9a27417ef903139e47ca0fef68be9fc7c58ca6a25b10107d6a34c73963e79a0b2702ffdc2637834bf784bd1fe0d69007cbd45f4021e4d">

        
    </head>
    <body class="no-js">
    <script data-inline type="text/javascript">function hasClass(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}var el=document.body;var cl="no-js";if(hasClass(el,cl)){var reg=new RegExp("(\\s|^)"+cl+"(\\s|$)");el.className=el.className.replace(reg," js-enabled")}</script>
        
        
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="../../../gitbook/style.css">
<link rel="stylesheet" href="../../../gitbook/theme.css">


        
    <div class="navbar">
        <div class="navbar-inner">
            <a class="brand" href="http://www.joomlatools.com">
                <img src="/theme/assets/images/slogan.png?1408441510" alt="Joomlatools logo" border="0">
            </a>
            <ul class="menu nav">
                <li><a href="http://www.joomlatools.com/extensions"><span>Extensions</span></a></li>
                <li><a href="http://www.joomlatools.com/pricing"><span>Pricing</span></a></li>
                <li><a href="http://blog.joomlatools.com"><span>Blog</span></a></li>
                <li><a href="http://demo.joomlatools.com/"><span>Demo</span></a></li>
                <li><a href="http://www.joomlatools.com/support"><span>Support</span></a></li>
            </ul>
        </div>
    </div>
    <div class="book" data-level="1.2.1.3" data-basepath="../../.." data-revision="1428687893243">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../../index.html">
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="extensions/docman/custom-icons.html">
            
                
                    <a href="../../../extensions/docman/custom-icons.html">
                         Extensions
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="extensions/docman/custom-icons.html">
            
                
                    <a href="../../../extensions/docman/custom-icons.html">
                         DOCman
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1.1" data-path="extensions/docman/custom-icons.html">
            
                
                    <a href="../../../extensions/docman/custom-icons.html">
                         Custom Icons
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1.1.1" data-path="extensions/docman/custom-icon-sizes.html">
            
                
                    <a href="../../../extensions/docman/custom-icon-sizes.html">
                         Sizes
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="1.1.2" data-path="extensions/docman/plugins.html">
            
                
                    <a href="../../../extensions/docman/plugins.html">
                         Plugins
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="extensions/logman.html">
            
                
                    <a href="../../../extensions/logman.html">
                         LOGman
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.2.1" data-path="extensions/logman/plugins/README.html">
            
                
                    <a href="../../../extensions/logman/plugins/README.html">
                         Plugins
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.2.1.1" data-path="extensions/logman/plugins/joomla.html">
            
                
                    <a href="../../../extensions/logman/plugins/joomla.html">
                         Joomla components
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2.1.2" data-path="extensions/logman/plugins/nooku.html">
            
                
                    <a href="../../../extensions/logman/plugins/nooku.html">
                         Nooku components
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="1.2.1.3" data-path="extensions/logman/plugins/activities.html">
            
                
                    <a href="../../../extensions/logman/plugins/activities.html">
                         Activities
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="1.2.2" data-path="extensions/logman/translations.html">
            
                
                    <a href="../../../extensions/logman/translations.html">
                         Translations
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="framework/template-system.html">
            
                
                    <a href="../../../framework/template-system.html">
                         Framework
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="framework/template-system.html">
            
                
                    <a href="../../../framework/template-system.html">
                         Template System
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1.1" data-path="framework/custom-css.html">
            
                
                    <a href="../../../framework/custom-css.html">
                         Custom CSS
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.1.2" data-path="framework/bootstrap.html">
            
                
                    <a href="../../../framework/bootstrap.html">
                         Bootstrap
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.1.3" data-path="framework/overrides.html">
            
                
                    <a href="../../../framework/overrides.html">
                         Overrides
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.1.4" data-path="framework/layouts.html">
            
                
                    <a href="../../../framework/layouts.html">
                         Layouts
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2.2" data-path="framework/plugins.html">
            
                
                    <a href="../../../framework/plugins.html">
                         Plugins
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="tools/composer/introduction.html">
            
                
                    <a href="../../../tools/composer/introduction.html">
                         Tools
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" data-path="tools/composer/introduction.html">
            
                
                    <a href="../../../tools/composer/introduction.html">
                         Composer
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1.1" data-path="tools/composer/installing.html">
            
                
                    <a href="../../../tools/composer/installing.html">
                         Installing Packages
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.1.2" data-path="tools/composer/creating.html">
            
                
                    <a href="../../../tools/composer/creating.html">
                         Distributing Packages
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.1.3" data-path="tools/composer/faq.html">
            
                
                    <a href="../../../tools/composer/faq.html">
                         FAQ
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3.2" data-path="tools/vagrant/introduction.html">
            
                
                    <a href="../../../tools/vagrant/introduction.html">
                         Vagrant
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.2.1" data-path="tools/vagrant/howto.html">
            
                
                    <a href="../../../tools/vagrant/howto.html">
                         How to use
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.2.2" data-path="tools/vagrant/faq.html">
            
                
                    <a href="../../../tools/vagrant/faq.html">
                         FAQ
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3.3" data-path="tools/console/introduction.html">
            
                
                    <a href="../../../tools/console/introduction.html">
                         Console
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.3.1" data-path="tools/console/installation.html">
            
                
                    <a href="../../../tools/console/installation.html">
                         Installation
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3.2" data-path="tools/console/usage.html">
            
                
                    <a href="../../../tools/console/usage.html">
                         Usage
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3.3" data-path="tools/console/faq.html">
            
                
                    <a href="../../../tools/console/faq.html">
                         FAQs
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../../" >Joomlatools Developer Zone</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_6">
                    
                        <h1 id="activities">Activities</h1>
<p>In LOGman, activity objects fully adhere to the <a href="http://activitystrea.ms/" target="_blank">Activity Streams specification</a> by implementing the <strong>ComActivitiesActivityInterface</strong>. Through this interface, activities effectively expose data to the outer world.</p>
<p>In the previous sections, we have seen that components can be integrated with LOGman by using plugins. These plugins take care of the activity logging process and make them available to LOGman.</p>
<p>Additionally, these plugins can also provide activity overrides that will get used by LOGman, and this for each resource type and for each component being integrated with LOGman, e.g. we may define an activity override for users, groups, user notes and/or user categories resources while integrating com_users with LOGman.</p>
<p>By providing activity overrides, the developer automatically gains control on how the activity exposes its data, and thus, how this data gets rendered.</p>
<p>Activity overrides can be provided by simply including activity classes in an <code>activity</code> folder located in your LOGman plugin root directory. The override filename must match the resource type as stored in the activities datababase, i.e. for a overriding a <code>user</code> activity, the override filename would be <code>user.php</code>.</p>
<p>For convenience, an activity override per component can also be defined, i.e. if the resource override <code>activity/user.php</code> is not found, LOGman will look for a component wide activity override inside the <code>activity/users.php</code> file (users being the package/component holding the resource referenced by the activity). If none is found, then the default activity object will get used.</p>
<p>Let us create our first activity override class. If we would like to create an activity override for a <code>bar</code> resource of our <code>foo</code> component we would add the following contents inside the <code>plugins/logman/foo/activity/bar.php</code> file:</p>
<pre><code class="lang-php"><span class="hljs-preprocessor">&lt;?php</span>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PlgLogmanFooActivityBar</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ComLogmanModelEntityActivity</span>
    </span>{
    }
</code></pre>
<p>We have successfully told LOGman to use our own activity object instead of the default <strong>ComLogmanModelEntityActivity</strong> class. Each time an activity from a <code>bar</code> resource of the <code>foo</code> component gets loaded by LOGman, this is the activity class that will get used.</p>
<h2 id="format">Format</h2>
<p>The activity format defines the text layout that is used for rendering activity messages.</p>
<p>These layouts can be defined during instantiation:</p>
<pre><code class="lang-php">    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_initialize</span><span class="hljs-params">(KObjectConfig <span class="hljs-variable">$config</span>)</span>
    </span>{
        <span class="hljs-variable">$config</span>-&gt;append(
            <span class="hljs-keyword">array</span>(<span class="hljs-string">'format'</span> =&gt; <span class="hljs-string">'{actor} {action} {object.type} title {object}'</span>
        );

        <span class="hljs-keyword">parent</span>::_initialize(<span class="hljs-variable">$config</span>);
    }
</code></pre>
<p>The <code>{actor} {action} {object.type} title {object}</code> string is what we call a short format. Short formats contain tokens (with {} placeholders) and constants (like the word title in our previous example).</p>
<p>Tokens are variables referencing <a href="http://activitystrea.ms/specs/json/1.0/#object" target="_blank">activity objects</a>. These objects represent the different components of an activity. We will learn more about them in the next section.</p>
<p>These activity objects can be accessed from an activity by using getters following the <code>getActivity{ObjectName}</code> naming convention, i.e. making a call like <code>$activity-&gt;getActivityActor()</code> for getting the activity <strong>actor</strong> object.</p>
<p>By issuing a call to the activity <strong>getActivityFormat</strong> method, we are given with a translated version of the short format string presented above. In English this call may return something like:</p>
<pre><code>{actor} {action} the {object.type} with the title {object}
</code></pre><p>The short format <code>{actor} {action} {object.type} title {object}</code> string gets translated by going through a key search process to find a suitable translation string in the translation files. The base translation key for the previous short format is:</p>
<pre><code>KLS_ACTOR_ACTION_OBJECTTYPE_TITLE_OBJECT
</code></pre><p>which translates itself to:</p>
<pre><code>    {actor} {action} the {object.type} with the title {object}
</code></pre><p>in the en-GB.com_activities.ini translations file.</p>
<p>When translating a short format string, tokens are first replaced with their corresponding activity object <code>objectName</code> property. As an example the <code>{actor}</code>, <code>{action}</code> and <code>{object}</code> tokens are replaced with the result of the <code>$activity-&gt;getActivityActor()-&gt;getObjectName()</code>, <code>$activity-&gt;getActivityAction()-&gt;getObjectName()</code> and <code>$activity-&gt;getActivityObject()-&gt;getObjectName()</code> calls respectively. <code>{object.type}</code> is a particular case. Its token replacement value is accessed with the <code>$activity-&gt;getActivityObject()-&gt;type-&gt;getObjectName()</code> call. For others dot format tokens, take <code>{foo.bar}</code> as an example, its replacement text can be accessed with the <code>$activity-&gt;getActivityFoo()-&gt;bar-&gt;getObjectName()</code> call.</p>
<p>Let us assume that, after this replacement, the short format string looks as follows:</p>
<pre><code>John deleted article title Tasks
</code></pre><p>This string gets used for constructing the following translation key:</p>
<pre><code>KLS_JOHN_DELETED_ARTICLE_TITLE_TASKS
</code></pre><p>If the key is found in the translations file, then it gets used. The activity translator will always look for the most specific key first, i.e. the one with all of its placeholders replaced. Then it will relax the search by ignoring some replacements until it finds a suitable key. For example, the next key to look for might well be:</p>
<pre><code>KLS_ACTOR_DELETED_ARTICLE_TITLE_TASKS
</code></pre><p>where the <code>{actor}</code> token value has been excluded (&quot;relaxed&quot;) while generating the key. This how the translator manages to provide translation overrides. Eventually, if a specialized key is not found, the most generic version of the key (with no token replacements at all) gets used:</p>
<pre><code>KLS_ACTOR_ACTION_OBJECTTYPE_TITLE_OBJECT
</code></pre><p>Translated formats provided by the <strong>getActivityFormat</strong> method still have their tokens un-replaced:</p>
<pre><code>{actor} {action} the {object.type} with the title {object}
</code></pre><p>This is intentional, as it allows consumers to do the replacement themselves by using (if any) a markup language of their choice.</p>
<p>Contrarily to short formats, tokens from the translated formats are to be replaced by the <code>displayName</code> property of the corresponding activity object. This property contains the displayable and potentially translated string of the activity object.</p>
<p>For the translated format string:</p>
<pre><code>{actor} {action} the {object.type} with the title {object}
</code></pre><p><code>{actor}</code>, <code>{action}</code> and <code>{object}</code> are replaced with the result of <code>$activity-&gt;getActivityActor()-&gt;getDisplayName()</code>, <code>$activity-&gt;getActivityAction()-&gt;getDisplayName()</code> and <code>$activity-&gt;getActivityObject()-&gt;getDisplayName()</code> calls respectively. Again, <code>{object.type}</code> is a special case. Its replacement value is accessed by making the <code>$activity-&gt;getActivityObject()-&gt;type-&gt;getDisplayName()</code> call. For others dot format tokens, take <code>{foo.bar}</code> as an example, its replacement text can be accessed with the <code>$activity-&gt;getActivityFoo()-&gt;bar-&gt;getDisplayName()</code> call.</p>
<p>By replacing tokens on translated formats, we get ourselves a rendered activity message:</p>
<pre><code>John deleted the article with the title FAQs
</code></pre><h2 id="activity-objects">Activity objects</h2>
<p>Activity objects are the backbone of an activity record. They represent the different parts of an activity and can be accessed with getters following the <code>getActivity{Object}</code> naming convention. The returned object must implement <strong>ComActivitiesActivityObjectInterface</strong>.</p>
<p>The base <strong>ComActivitiesModelEntityActivity</strong> activity class already provide getters for activity objects referenced in the Activity Streams specification, i.e. actor, object, target, generator and provider.</p>
<p>The way on which any of the activity objects gets constructed can, and sometimes must, be modified. Let us see how.</p>
<h3 id="configuration">Configuration</h3>
<p>The base activity object getters make calls to <code>_{object}Config</code> methods (where <code>{object}</code> is the object&#39;s name, e.g. actor, action, object, etc.). These are basically configuration setters for setting configuration objects that get used for instantiating activity objects. By overriding these methods you can change the way activity objects get instantiated.</p>
<p>Let us assume that in our <code>bar</code> activity override, the main activity object URL is being wrongly set. Not a problem, we just need to change/override the way the URL property gets set in the configuration object. For this we would need to add the following code in our activity override class:</p>
<pre><code class="lang-php">    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_objectConfig</span><span class="hljs-params">(KObjectConfig <span class="hljs-variable">$config</span>)</span>
    </span>{
        <span class="hljs-variable">$config</span>-&gt;append(<span class="hljs-keyword">array</span>(<span class="hljs-string">'url'</span> =&gt; <span class="hljs-string">'option=com_foo&amp;view=bar&amp;id='</span> . <span class="hljs-variable">$activity</span>-&gt;row));
        <span class="hljs-keyword">parent</span>::_objectConfig(<span class="hljs-variable">$config</span>);
    }
</code></pre>
<p>That&#39;s it, just a couple of lines and we are all set.</p>
<p>All of the activity objects currently implemented in the activity class are overridable this way.</p>
<h3 id="instantiation">Instantiation</h3>
<p>A call to <code>ComLogmanModelEntityActivity::_getObject</code> is always made when instantiating activity objects. This method takes care of a few things such as translating properties, routing URLs, finding objects, etc. It is always recommended to use this getter when creating activity objects. You will learn how to create your own objects latter on.</p>
<p>The configuration object that gets passed to <code>ComLogmanModelEntityActivity::_getObject</code> may contain any of the properties that may be set in the <strong>ComActivitiesActivityObject</strong> class, i.e. objectName, displayName, attachments, author, content, downstreamDuplicates, etc. Make sure to take a look at the class implementation to see all the available properties. By simply passing these properties within the configuration object, they will get set in the resulting activity object. Additionally the following properties may also be included:</p>
<ul>
<li><em>find</em>: A string pointing to a related resource to look for. When this property is set, a call to a <code>_findObject{Object}</code> finder method will get issued for determining if an object&#39;s resource exists. If it does not exists, the URL property of the object will be set to null, effectively making it non-linkable. Additionally, its deleted property will get set to true as well. As an example, if we set the configuration object as follows: <code>$config-&gt;find = &#39;object&#39;</code>, the URL and delete properties of the resulting activity object will be set accordingly, provided the result of the <strong>_findObjectObject</strong> finder method.</li>
<li><em>translate</em>: An array containing property names to translate. By default, and if translate is not defined or not equal to false, only the <code>displayName</code> property will get translated. If an array of properties is provided, only those properties will get translated. If false is provided, no property gets translated at all.</li>
</ul>
<p>If the the <code>objectName</code> property is set, the <strong>_getObject</strong> method will automatically set a <code>displayName</code> property if this one is not already set. The value of this property is the <code>objectName</code> property value.</p>
<p>Let us suppose that we would like to add an additional dot property to the object activity object of our <code>bar</code> activity override. We do this as follows:</p>
<pre><code class="lang-php">    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_objectConfig</span><span class="hljs-params">(KObjectConfig <span class="hljs-variable">$config</span>)</span>
    </span>{
        <span class="hljs-variable">$config</span>-&gt;append(
            <span class="hljs-keyword">array</span>(
                <span class="hljs-string">'bar'</span> =&gt; <span class="hljs-keyword">array</span>(
                    <span class="hljs-string">'object'</span>     =&gt; <span class="hljs-keyword">true</span>,
                    <span class="hljs-string">'objectName'</span> =&gt; <span class="hljs-string">'Howdy'</span>
                )
            )
        )
    }
</code></pre>
<p>By only providing a <code>bar</code> property which contains an array with its <code>object</code> key set to true, the object getter will automatically know that <code>bar</code> is supposed to be an activity object. The object getter will take care of instantiating it as such, just like it would with any other object. This means that all of the exposed above also applies to nested objects. Even better, there is no limit on how many objects can be nested:</p>
<pre><code class="lang-php">    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_objectConfig</span><span class="hljs-params">(KObjectConfig <span class="hljs-variable">$config</span>)</span>
    </span>{
        <span class="hljs-variable">$config</span>-&gt;append(
            <span class="hljs-keyword">array</span>(
                <span class="hljs-string">'foo'</span> =&gt; <span class="hljs-keyword">array</span>(
                    <span class="hljs-string">'object'</span>     =&gt; <span class="hljs-keyword">true</span>,
                    <span class="hljs-string">'objectName'</span> =&gt; <span class="hljs-string">'This is Foo'</span>,
                    <span class="hljs-string">'bar'</span> =&gt; <span class="hljs-keyword">array</span>(
                        <span class="hljs-string">'object'</span> =&gt; <span class="hljs-keyword">true</span>,
                        <span class="hljs-string">'objectName'</span> =&gt; <span class="hljs-string">'This is Bar inside Foo'</span>
                        <span class="hljs-string">'url'</span> =&gt; <span class="hljs-string">'option=bar&amp;view=bars'</span>,
                        <span class="hljs-string">'find'</span> =&gt; <span class="hljs-string">'bar'</span>
                    )
                )
            )
        )
    }
</code></pre>
<p>If we make a call like <code>$this-&gt;getActivityObject()-&gt;foo-&gt;bar</code> we get ourselves an activity object. Nice uh?. As mentioned above, a <code>displayName</code> will get set for both <code>foo</code> and <code>bar</code> objects using their corresponding <code>objectName</code> properties. You are of course free to change that by providing your own <code>displayName</code> properties. Their <code>displayName</code> properties will also get translated by default unless a <code>translate</code> property is provided for each of them with either a list of properties or their values set to false. We have also told the object getter to perform a search for <code>bar</code> on the the <code>bar</code> object configuration. This will internally trigger a call to <code>_findObjectBar</code> (if such a method exists) and set the deleted and url properties of the <code>bar</code> object accordingly.</p>
<h3 id="finding-objects">Finding objects</h3>
<p>As mentioned above, by passing a <code>find</code> property to the <strong>_getObject</strong> method configuration object, the object getter will attempt to find the referenced resource and act over the configuration properties accordingly.</p>
<p>If we take a closer look at the  <strong>ComActivitiesModelEntityActivity::_findObjectActor</strong> and <strong>ComActivitiesModelEntityActivity::_findObjectObject</strong> methods, we realize that all that they are doing is to search for activity objects and return the search result. The actor finder is unlikely to need changes. On the other hand the <strong>_findObjectObject</strong> method makes use of two instance properties that get set during the activity instantiation: </p>
<ul>
<li><em>_object_table</em>: A string containing the name of the database table holding the object resources, i.e. the <code>bar</code> rows.</li>
<li><em>_object_column</em>: A string containing the name of the identity column of the database table containing the object resources.</li>
</ul>
<p>Let us suppose that in our hypothetical <code>com_foo</code> component, our <code>bar</code> resources get stored in a database table called <code>bars</code>. The identity column of this table is <code>bar_id</code>. If this is the case, then we would setup the above finder properties as follows:</p>
<pre><code class="lang-php">    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_initialize</span><span class="hljs-params">(KObjectConfig <span class="hljs-variable">$config</span>)</span>
    </span>{
        <span class="hljs-variable">$config</span>-&gt;append(
            <span class="hljs-keyword">array</span>(
                <span class="hljs-string">'object_table'</span>  =&gt; <span class="hljs-string">'bars'</span>,
                <span class="hljs-string">'object_column'</span> =&gt; <span class="hljs-string">'bar_id'</span>,
            )
        );

        <span class="hljs-keyword">parent</span>::_initialize(<span class="hljs-variable">$config</span>);
    }
</code></pre>
<p>The object finder will now be able to determine if a given <code>bar</code> resource referenced in an activity record still exists.</p>
<h3 id="urls">URLs</h3>
<p>Activity object URLs may be set in two different ways. By talking a closer look to <strong>ComActivitiesActivityObject::getUrl</strong> you may see that URL are KHttpUrl objects. As we previously mentioned, activity objects are created by using a <strong>_getObject</strong> factory method. This method accepts a configuration object which may contain a url property for setting the activity object URL. </p>
<p>If the url property is a string, the <strong>_getObject</strong> method will assume that it contains a query string. This query string will get routed, and the creation of the KHttpUrl object is taken cared off.</p>
<p>If the url property already contains a KHttpUrl object, the <strong>_getObject</strong> method will just use it AS IS.</p>
<p>The method you will use will basically depend on whether routing is needed or not.</p>
<h2 id="icons">Icons</h2>
<p>Activity messages that get rendered by LOGman, are usually assigned an icon to easily differentiate one activity from another. This icon is simply a CSS class that gets assigned to a given activity. The name of the CSS class is made available through the image property, e.g. <code>$activity-&gt;image</code>.</p>
<p>For changing the value of this property, we just need to override the <strong>getPropertyImage</strong> method inside the activity override class:</p>
<pre><code class="lang-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPropertyImage</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-variable">$images</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'walk'</span> =&gt; <span class="hljs-string">'icon-walk'</span>, <span class="hljs-string">'run'</span> =&gt; <span class="hljs-string">'icon-run'</span> , <span class="hljs-string">'sit'</span> =&gt; <span class="hljs-string">'icon-sit'</span>);

        <span class="hljs-variable">$image</span> = <span class="hljs-string">'icon-default'</span>;

        <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$this</span>-&gt;verb, array_keys(<span class="hljs-variable">$images</span>))) {
            <span class="hljs-variable">$image</span> = <span class="hljs-variable">$images</span>[<span class="hljs-variable">$this</span>-&gt;verb];        
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$image</span>;
    }
</code></pre>
<p>An icon is often assigned to a given activity action, but you could perfectly assign one icon to all of the activities of a given resource and/or component. This is left to the implementer&#39;s discretion.</p>
<h2 id="extending-the-specification">Extending the specification</h2>
<p>The activity API is not static. While we already provide a very complete platform for logging and exposing activity streams, nothing prevents developers to bend activities to their needs and likings by extending the Activity Streams specification and/or our implementation. </p>
<p>As an example, adding new activity objects is a breeze. Let&#39;s assume that our <code>bar</code> activity also has related <code>baz</code> resources. Let us take this into account in our activity override.</p>
<p>We can extend the activity by just adding a <code>baz</code> activity object to it. First we provide a getter for the object:</p>
<pre><code class="lang-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getActivityBaz</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-variable">$config</span> = <span class="hljs-keyword">new</span> KObjectConfig();

        <span class="hljs-comment">// Set the baz activity object configuration</span>
        ...

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;_getObject(<span class="hljs-variable">$config</span>);
    }
</code></pre>
<p>Easy right?. Setting the object&#39;s configuration is nothing more than setting the data of the activity object we are creating. In this case, we are setting data from a <code>baz</code> related resource. This data may be grabbed from the activity row itself (possibly stored in the metadata property) or it can be queried directly from the database table holding <code>baz</code> rows. Anything works, this all depends on the implementation of the component being integrated, and whether or not the information is made available in the activities table.</p>
<p>After providing a getter for the client activity object, we can now make use of it by referencing it in short formats:</p>
<pre><code>{actor} {action} {object.type} {baz} title {object}
</code></pre><p>which may translate to:</p>
<pre><code>{actor} {action} the {object.type} from {baz} with title {object}
</code></pre><p>For the object to be renderable on JSON activity streams, we need the activity to be aware of this new object. We can easily do so by specifying this at instantiation time:</p>
<pre><code class="lang-php">    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_initialize</span><span class="hljs-params">(KObjectConfig <span class="hljs-variable">$config</span>)</span>
    </span>{
        <span class="hljs-variable">$config</span>-&gt;append(<span class="hljs-keyword">array</span>(<span class="hljs-string">'objects'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'baz'</span>)));
        <span class="hljs-keyword">parent</span>::_initialize(<span class="hljs-variable">$config</span>);
    }
</code></pre>
<p>By appending <code>baz</code> to the objects array, we are effectively telling the activity that we are adding a <code>baz</code> object. The <code>baz</code> activity object will now get displayed as part of the activity on JSON activity streams. JSON activity streams can be accessed by appending <em>&amp;format=json&amp;layout=stream</em> to the URL query.</p>
<p>When working with activity overrides, we strongly encourage developers to review the entire activity package (classes under the <code>activity</code> folder of the base activity component located at <code>libraries/koowa/components/com_activities</code>) as well as the <strong>ComActivitiesModelEntityActivity</strong> and <strong>ComLogmanModelEntityActivity</strong> implementations. Knowing the ins and outs of activity entities will be of great help while developing activity overrides for your LOGman plugins.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../../extensions/logman/plugins/nooku.html" class="navigation navigation-prev " aria-label="Previous page: Nooku components"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../../extensions/logman/translations.html" class="navigation navigation-next " aria-label="Next page: Translations"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../../gitbook/theme.js"></script>
<script src="../../../gitbook/app.js"></script>

    
    <script src="../../../gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../../../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"ga":{"token":"UA-214238-3","configuration":"auto"}};
    gitbook.start(config);
});
</script>

        <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-214238-3', 'auto');ga('send', 'pageview');</script>
    </body>
    

    <script>
        require(["gitbook", "jquery"], function(gitbook, $) {
            var load = function(){
                $('ul.summary li.active').parents('ul.articles').show().addClass('expanded').parent('li').addClass('active-parent');
            };
            $(document).ready(load)

            gitbook.events.bind("page.change", load);
        });
    </script>
</html>
